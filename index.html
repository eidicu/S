<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <title>كتابة إلى ملف JSON على GitHub</title>
</head>
<body>
    <h2>تعديل ملف JSON:</h2>
    <textarea id="jsonInput" rows="10" cols="50">{"name": "John", "age": 30, "city": "New York"}</textarea>
    <br>
    <button id="saveBtn">حفظ التغييرات</button>
    <pre id="response"></pre>

    <script>
        const apiUrl = 'https://api.github.com/repos/eidicu/John/contents/data.json'; // استبدلها بالمعلومات الصحيحة
        const token = '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'; // استخدم الرمز هنا

        // حفظ التغييرات
        document.getElementById('saveBtn').addEventListener('click', function() {
            const updatedData = document.getElementById('jsonInput').value;

            // جلب SHA للملف الحالي
            fetch(apiUrl, {
                headers: {
                    'Authorization': `token ${token}`,
                    'Accept': 'application/vnd.github.v3+json'
                }
            })
            .then(response => response.json())
            .then(fileData => {
                const sha = fileData.sha; // SHA الخاص بالملف الحالي

                // تحديث محتوى الملف
                const updateContent = {
                    message: "تحديث ملف JSON",
                    content: btoa(unescape(encodeURIComponent(updatedData))), // تحويل إلى Base64
                    sha: sha
                };

                return fetch(apiUrl, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Accept': 'application/vnd.github.v3+json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(updateContent)
                });
            })
            .then(response => response.json())
            .then(data => {
                if (data.content) {
                    document.getElementById('response').textContent = 'تم تحديث الملف بنجاح!';
                } else {
                    document.getElementById('response').textContent = 'حدث خطأ في تحديث الملف.';
                }
            })
            .catch(error => console.error('خطأ:', error));
        });
    </script>
</body>
</html>
